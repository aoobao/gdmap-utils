!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).AMapUtils=e()}(this,function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(o){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},e=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),e.forEach(function(t){var e,i,n;e=o,n=a[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n})}return o}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function u(t,e,i){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function _(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(t,e){return void 0===t?e:t}function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"|",s=[],r=/\d+(\.\d+)?/g;"string"==typeof t?t.split(e).forEach(function(t){if(t){for(var e=[],i=t.match(r),n=1;n<i.length;n+=2){var o=parseFloat(i[n-1]),a=parseFloat(i[n]);e.push([o,a])}s.push(e)}}):console.warn("经纬度格式有误:",t);return s}function y(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:20;return t?t.replace(/[^\\x00-\\xff]/g,"aa").length*e/2:0}function d(t,e,i,n){return{minZoom:t<i?i:t,maxZoom:n<e?n:e}}function v(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(t,e){return e?r({},t,e):t},{})}function g(t,e,i,n){var o=Math.abs(t-i),a=Math.abs(e-n),s=Math.sqrt(Math.pow(o,2)+Math.pow(a,2));if(0==s)return 0;var r=a/s,l=180*Math.acos(r)/Math.PI;return l=t<=i?e<=n?90-l:270+l:e<=n?90+l:270-l}var t=Object.freeze({getDefaultByundefined:f,transposePolyrect:p,getTextWidth:y,getDiffObject:function(t,e){var i={},n=!1;for(var o in e){var a=t[o];void 0===a&&console.warn("目标对象未找到该参数:"+o);var s=e[o];a!==s&&(i[o]=s,n=!0)}return n?i:null},getIntersection:d,getMergeObject:v,getAngle:g}),m=function(){function e(t){o(this,e),this.__initialize(t||{})}return a(e,[{key:"__initialize",value:function(t){var e=this;this.CLASS_NAME=this.constructor.name,this.__map=t.map||null,this.__position=t.position,this.__zIndex=t.zIndex||10,this.__extData=t.extData,t.map&&setTimeout(function(){e.setMap(t.map)},1)}},{key:"__callMethod",value:function(t,e){for(var i=this,n=arguments.length,o=new Array(2<n?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];null!==t&&(Array.isArray(t)?t.forEach(function(t){i.__callMethod.apply(i,[t,e].concat(o))}):"object"===s(t)?"function"==typeof t[e]?t[e].apply(t,o):console.warn("对象找不到方法:"+e,t):console.warn("传入值不是实例对象",t))}},{key:"__changeOptions",value:function(n){var o=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=!1;return(Array.isArray(t)?t:Object.keys(n)).forEach(function(t){if(t in n){var e="_"+t,i=o[e];void 0===i&&console.warn("未找到该字段属性:"+t),i!==n[t]&&(o[e]=n[t],a=!0)}}),a}},{key:"getzIndex",value:function(){return this.__zIndex}},{key:"setzIndex",value:function(t){this.__zIndex=t;var e=this.getOverlays();this.__callMethod(e,"setzIndex",t)}},{key:"getExtData",value:function(){return this.__extData}},{key:"setExtData",value:function(t){this.__extData=t}},{key:"getPosition",value:function(){return this.__position}},{key:"setPosition",value:function(t){this.__position;var e=this.getOverlays();this.__callMethod(e,"setPosition",t)}},{key:"getOverlays",value:function(){return this.__overlays}},{key:"setOverlays",value:function(t){this.__overlays=t}},{key:"isShow",value:function(){return null!==this.getMap()}},{key:"setMap",value:function(t){this.__map=t;var e=this.getOverlays();this.__callMethod(e,"setMap",t)}},{key:"getMap",value:function(){return this.__map||null}},{key:"destroy",value:function(){this.setMap(null)}}]),e}();function k(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}k(".dcmap-normaltext-container {\n  width: 0px;\n  pointer-events: none; }\n  .dcmap-normaltext-container .text {\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center; }\n");var x=function(t){function i(t){var e;return o(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e}return e(i,m),a(i,[{key:"_initialize",value:function(t){this._text=t.text||"",this._textColor=t.textColor||"#fff",this._paddingWidth=t.paddingWidth||20,this._textSize=t.textSize||20,this._paddingHeight=t.paddingHeight||10,this._offsetTop=t.offsetTop||0,this._offsetLeft=t.offsetLeft||0,this._createMarker()}},{key:"_createMarker",value:function(){var t=y(this._text,this._textSize)+this._paddingWidth,e=this._textSize+this._paddingHeight,i=this._dom=this._createElement(e,t),n=new AMap.Marker({position:this.getPosition(),offset:new AMap.Pixel(-t/2+this._offsetLeft,-e/2+this._offsetTop),content:i.body,bubble:!0,zIndex:this.getzIndex()});this.setOverlays(n)}},{key:"_createElement",value:function(t,e){var i=document.createElement("div");i.className="dcmap-normaltext-container",i.style.height=t+"px";var n=document.createElement("div");return n.className="text",n.style.width=e+"px",n.style.fontSize=this._textSize+"px",n.style.color=this._textColor,n.innerText=this._text,i.appendChild(n),{body:i,text:n}}},{key:"getTextColor",value:function(){return this._textColor}},{key:"setTextColor",value:function(t){this._textColor=t,this._dom.text.style.color=this._textColor}},{key:"getValue",value:function(){return this._text}},{key:"setValue",value:function(t){this._text=t,this._dom.text.innerText=this._text}}]),i}(),b=function(t){function n(t){var e;return o(this,n),(e=c(this,l(n).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(n,m),a(n,[{key:"_initialize",value:function(t){this._strokeColor=t.strokeColor||"#f00",this._strokeOpacity=f(t.strokeOpacity,.8),this._strokeWeight=f(t.strokeWeight,1),this._fillColor=t.fillColor||"blue",this._fillOpacity=f(t.fillOpacity,.2),this._textOption=t.textOption||{text:t.text||"未输入文字内容",textColor:t.textColor||"red"},this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._useCanvas=f(t.useCanvas,!1),this._coordinate=p(t.coordinate),this._checkCoordinate=p(t.checkCoordinate||""),this._createCheckPolygon(),this.isUseCanvas()?this._createCustomLayer():(this._createPolygon(),this._overLayGroup=new AMap.OverlayGroup(this._polygons));var e=f(t.textClass,x);e&&this._createText(e)}},{key:"_createText",value:function(t){if(this._textObj&&("function"==typeof this._textObj.destroy&&this._textObj.destroy(),this._textObj=null),t){var e=f(this._textOption.minZoom,1),i=f(this._textOption.maxZoom,19),n=d(this.__minZoom,this.__maxZoom,e,i),o=r({map:this.getMap(),position:this.getPosition(),zIndex:this.getzIndex()},this._textOption,n);this._textObj=new t(o)}else console.warn("未找到文字对象,检查textClass参数",t)}},{key:"_createCheckPolygon",value:function(){var i=this;this.hasCheckPolygon()&&(1<this._checkCoordinate.length&&console.warn("checkCoordinate建议设置为单区域简单多边形以提高性能"),this._checkPolygons=this._checkCoordinate.map(function(t){var e=new AMap.Polygon({path:t,strokeOpacity:0,strokeWeight:0,fillOpacity:0,zIndex:i.__zIndex+1,bubble:!0});return i._addEvent(e),e}))}},{key:"_createPolygon",value:function(){var i=this,n=this.hasCheckPolygon();this._polygons=this._coordinate.map(function(t){var e=new AMap.Polygon({path:t,strokeColor:i._strokeColor,strokeOpacity:i._strokeOpacity,strokeWeight:i._strokeWeight,fillColor:i._fillColor,fillOpacity:i._fillOpacity,zIndex:i.__zIndex,bubble:!0});return n||i._addEvent(e),e})}},{key:"_createCustomLayer",value:function(){var t=this._canvas=document.createElement("canvas");if(this._ctx=t.getContext("2d"),this.getMap()){var e=this.getMap().getSize();t.width=this._canvas_width=e.width,t.height=this._canvas_height=e.height}this._cus=new AMap.CustomLayer(t,{zIndex:10}),this._cus.render=this._draw.bind(this)}},{key:"_draw",value:function(){this._clearCanvas(this._ctx),this._drawCanvas(this._ctx)}},{key:"_clearCanvas",value:function(t){t.clearRect(0,0,this._canvas_width,this._canvas_height)}},{key:"_drawCanvas",value:function(i){var n=this;i.save(),i.strokeStyle=this._strokeColor,i.lineWidth=this._strokeWeight,i.fillStyle=this._fillColor,this._coordinate.forEach(function(t){var e=t.map(function(t){return n.getMap().lngLatToContainer(t)});i.beginPath(),i.globalAlpha=n._strokeOpacity,e.forEach(function(t){i.lineTo(t.getX(),t.getY())}),i.closePath(),i.stroke(),i.globalAlpha=n._fillOpacity,i.fill()}),i.restore()}},{key:"_addEvent",value:function(t){t.on("mouseover",this._mouseOver),t.on("mouseout",this._mouseOut),t.on("click",this._clickHandle)}},{key:"_mouseOut",value:function(t){"function"==typeof this._mouseout&&this._mouseout.call(this,this.getExtData(),t,this)}},{key:"_mouseOver",value:function(t){"function"==typeof this._mouseover&&this._mouseover.call(this,this.getExtData(),t,this)}},{key:"_clickHandle",value:function(t){"function"==typeof this._click&&this._click.call(this,this.getExtData(),t,this)}},{key:"isUseCanvas",value:function(){return!!this._useCanvas}},{key:"getText",value:function(){return this._textObj||null}},{key:"setText",value:function(t){var e=this.getText();e&&e.destroy(),this._textObj=t,this.getMap()}},{key:"getPolygonStyle",value:function(){return{strokeColor:this._strokeColor,strokeOpacity:this._strokeOpacity,strokeWeight:this._strokeWeight,fillColor:this._fillColor,fillOpacity:this._fillOpacity}}},{key:"setPolygonStyle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.__changeOptions(t,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"])&&(this.isUseCanvas()?this._draw():this._overLayGroup.setOptions(t))}},{key:"getOverlays",value:function(){var t=_(this._checkPolygons||[]);this._polygons&&t.push.apply(t,_(this._polygons));var e=this.getText();return e&&t.push(e),this._cus&&t.push(this._cus),t}},{key:"setMap",value:function(t){if(u(l(n.prototype),"setMap",this).call(this,t),t&&this.isUseCanvas()){var e=this._canvas,i=t.getSize();e.width=this._canvas_width=i.width,e.height=this._canvas_height=i.height}}},{key:"hasCheckPolygon",value:function(){return this._checkCoordinate&&0<this._checkCoordinate.length}},{key:"destroy",value:function(){u(l(n.prototype),"destroy",this).call(this)}}]),n}(),O=function(t){function i(t){var e;return o(this,i),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(i,m),a(i,[{key:"_clickHandle",value:function(t,e,i){"function"==typeof this._click&&this._click.call(this,i,e)}},{key:"_mouseOut",value:function(t,e,i){"function"==typeof this._mouseout&&this._mouseout.call(this,i,e)}},{key:"_mouseOver",value:function(t,e,i){"function"==typeof this._mouseover&&this._mouseover.call(this,i,e)}},{key:"_initialize",value:function(t){this._strokeColor=t.strokeColor||"#f00",this._strokeOpacity=f(t.strokeOpacity,.8),this._strokeWeight=f(t.strokeWeight,1),this._fillColor=t.fillColor||"blue",this._fillOpacity=f(t.fillOpacity,.2),this._textOption=t.textOption,this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._useCanvas=f(t.useCanvas,!1),this._textClass=t.textClass,this._polyrects=[]}},{key:"getPolygonStyle",value:function(){return{strokeColor:this._strokeColor,strokeOpacity:this._strokeOpacity,strokeWeight:this._strokeWeight,fillColor:this._fillColor,fillOpacity:this._fillOpacity}}},{key:"setPolygonStyle",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.__changeOptions(e,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"])&&this._polyrects&&0<this._polyrects.length&&this._polyrects.forEach(function(t){t.setPolygonStyle(e)})}},{key:"setData",value:function(t){var i=this;this.clear();var n=f;this._polyrects=t.map(function(t){var e={map:i.getMap(),checkCoordinate:t.checkCoordinate,coordinate:t.coordinate,position:t.position,strokeColor:n(t.strokeColor,i._strokeColor),strokeWeight:n(t.strokeWeight,i._strokeWeight),strokeOpacity:n(t.strokeOpacity,i._strokeOpacity),fillColor:n(t.fillColor,i._fillColor),fillOpacity:n(t.fillOpacity,i._fillOpacity),textOption:v(i._textOption,t.textOption),textClass:n(t.textClass,i._textClass),useCanvas:i._useCanvas,click:i._clickHandle,mouseout:i._mouseOut,mouseover:i._mouseOver,extData:t.extData||t,zIndex:t.zIndex||i.getzIndex()};return new b(e)})}},{key:"getPolyrects",value:function(){return _(this._polyrects||[])}},{key:"showText",value:function(){var i=this;this.getPolyrects().forEach(function(t){var e=t.getText();e&&e.setMap(i.getMap())})}},{key:"hideText",value:function(){this.getPolyrects().forEach(function(t){var e=t.getText();e&&e.setMap(null)})}},{key:"clear",value:function(){var t=this.getOverlays();t&&0<t.length&&(t.forEach(function(t){t.destroy()}),this._polyrects=[])}},{key:"getOverlays",value:function(){return this.getPolyrects()}},{key:"destroy",value:function(){u(l(i.prototype),"destroy",this).call(this)}}]),i}();k('.dcmap-text3d-container {\n  width: 0;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: space-between;\n  align-items: center;\n  -webkit-transform-style: preserve-3d;\n          transform-style: preserve-3d; }\n  .dcmap-text3d-container .map-point-text-dom {\n    width: 500px;\n    display: flex;\n    justify-content: center;\n    font-size: 16px;\n    pointer-events: none; }\n  .dcmap-text3d-container .map-point-img-dom {\n    width: 25px;\n    height: 35px;\n    margin: 3px 0;\n    background-image: url("http://qn.fengyitong.name/point.png"); }\n  .dcmap-text3d-container .map-point-small-circle {\n    position: absolute;\n    width: 54px;\n    height: 54px;\n    bottom: -20px;\n    left: 50%;\n    margin-left: -27px;\n    background-color: #0080fe;\n    opacity: 0.5;\n    border-radius: 50%;\n    -webkit-animation: delayLiving 1.5s linear infinite;\n            animation: delayLiving 1.5s linear infinite;\n    display: none; }\n  .dcmap-text3d-container .map-point-large-circle {\n    position: absolute;\n    width: 116px;\n    height: 116px;\n    bottom: -50px;\n    left: 50%;\n    margin-left: -58px;\n    background-color: #0080fe;\n    border-radius: 50%;\n    opacity: 0;\n    -webkit-animation: bigliving 1.5s linear infinite;\n            animation: bigliving 1.5s linear infinite;\n    display: none; }\n\n@-webkit-keyframes delayLiving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.1; }\n  30% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.5; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@keyframes delayLiving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.1; }\n  30% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.5; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@-webkit-keyframes bigliving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.3; }\n  /* 50% {\r\n      transform: scale(2);\r\n      opacity: 0;\r\n    } */\n  70% {\n    -webkit-transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n            transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n    opacity: 0.1; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@keyframes bigliving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.3; }\n  /* 50% {\r\n      transform: scale(2);\r\n      opacity: 0;\r\n    } */\n  70% {\n    -webkit-transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n            transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n    opacity: 0.1; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n');var w=function(t){function i(t){var e;return o(this,i),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(i,m),a(i,[{key:"_initialize",value:function(t){this._text=t.text||"",this._textColor=t.textColor,this._showRipples=!!t.isShowRipples,this._imageOption=t.imageOption||{},this._className=t.className,this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._createMarker()}},{key:"showRipples",value:function(){var t=this._dom;t.smallCircle.style.display="block",t.largeCircle.style.display="block",this._showRipples=!0}},{key:"closeRipples",value:function(){var t=this._dom;t.smallCircle.style.display="",t.largeCircle.style.display="",this._showRipples=!1}},{key:"_clickHandle",value:function(t){"function"==typeof this._click&&this._click.call(this,this.getExtData(),t)}},{key:"_mouseOut",value:function(t){"function"==typeof this._mouseout&&this._mouseout.call(this,this.getExtData(),t)}},{key:"_mouseOver",value:function(t){"function"==typeof this._mouseover&&this._mouseover.call(this,this.getExtData(),t)}},{key:"_createMarker",value:function(){var t=this._dom=this._createElement(),e=this._imageOption.height||35;t.body.addEventListener("mouseenter",this._mouseOver),t.body.addEventListener("mouseleave",this._mouseOut),t.body.addEventListener("click",this._clickHandle);var i=new AMap.Marker({position:this.__position,offset:new AMap.Pixel(0,-e-20),content:t.body,zIndex:this.getzIndex()});this.setOverlays(i),this._showRipples&&this.showRipples()}},{key:"getValue",value:function(){return this._text}},{key:"setValue",value:function(t){this._dom.text.innerText=strText,this._text=strText}},{key:"_createElement",value:function(){var t=this._imageOption.height||35,e=document.createElement("div");e.className="dcmap-text3d-container "+this._className,e.style.height=t+30+"px";var i=document.createElement("div");i.className="map-point-small-circle",e.appendChild(i);var n=document.createElement("div");n.className="map-point-large-circle",e.appendChild(n);var o=document.createElement("span");o.className="map-point-text-dom",o.style.color=this._textColor,o.innerText=this._text,e.appendChild(o);var a=document.createElement("div");return a.className="map-point-img-dom",a.style.width=this._imageOption.width||25,a.style.height=t,this._imageOption.src&&(a.style.backgroundImage="url('".concat(this._imageOption.src,"')")),e.appendChild(a),{body:e,text:o,img:a,smallCircle:i,largeCircle:n}}}]),i}(),C=function(){function e(t){o(this,e),this._draw=this._draw.bind(this),this._initialize(t||{})}return a(e,[{key:"_initialize",value:function(t){this._map=t.map,this._center=t.center,this._target=t.target,this._speed=t.speed||60,this._coverNumber=t.coverNumber||.2,this._fillStyle=t.fillStyle||"rgba(0,200,0,0.7)",this._callback=t.callback,this._isStart=!1,this._deg=360-~~g.apply(void 0,_(this._center).concat(_(this._target))),this._createCanvasLayer()}},{key:"_createCanvasLayer",value:function(){var t=this._canvas=document.createElement("canvas");this._ctx=t.getContext("2d");var e,i,n,o=(e=this._center,i=this._target,n=Math.sqrt(Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2)),{minPosition:[e[0]-n,e[1]-n],maxPosition:[e[0]+n,e[1]+n]}),a=this._map.lngLatToContainer(o.minPosition),s=this._map.lngLatToContainer(o.maxPosition);t.width=t.height=this._width=this._height=s.getX()-a.getX(),this._clayer=new AMap.CanvasLayer({canvas:t,bounds:new AMap.Bounds(o.minPosition,o.maxPosition),zIndex:100}),this._clayer.setMap(this._map)}},{key:"start",value:function(){this._isStart||(this._isStart=!0,this._draw())}},{key:"stop",value:function(){var t=this;this._isStart&&(this._isStart=!1,setTimeout(function(){t._ctx.clearRect(0,0,t._width,t._height)},1))}},{key:"destroy",value:function(){this.stop(),this._clayer.setMap(null),this._clayer=null}},{key:"_drawCircle",value:function(){var t=(this._width>this._height?this._height:this._width)/2,e=this._ctx2;e.clearRect(0,0,this._width,this._height),e.fillStyle=this._fillStyle,e.globalAlpha=.2,e.beginPath(),e.moveTo(this._width/2,this._height/2),e.arc(this._width/2,this._height/2,t,0,2*Math.PI),e.closePath(),e.fill()}},{key:"_draw",value:function(){var t=this._deg;this._deg+=360/this._speed,360<=this._deg&&(this._deg=this._deg-360),this._isStart&&(this._drawRadar(),this._cover(),this._clayer.reFresh(),"function"==typeof this._callback&&this._callback.call(this,{start:t,end:this._deg>t?this._deg:this._deg+t}),window.requestAnimationFrame(this._draw))}},{key:"_drawRadar",value:function(){var t=this._deg,e=this._ctx,i=(this._width>this._height?this._height:this._width)/2;e.save(),e.fillStyle=this._fillStyle,e.beginPath(),e.moveTo(this._width/2,this._height/2),e.arc(this._width/2,this._height/2,i,(-360/this._speed+t)/180*Math.PI,t/180*Math.PI),e.closePath(),e.fill(),e.restore()}},{key:"_cover",value:function(){var t=this._ctx;t.save();this._width>this._height?this._height:this._width;t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0,0,0,".concat(this._coverNumber,")"),t.rect(0,0,this._width,this._height),t.fill(),t.restore()}},{key:"_clearRect",value:function(){this._ctx.clearRect(0,0,this.width,this.height)}}]),e}();var M=function(){function e(t){o(this,e),this._draw=this._draw.bind(this),this._initialize(t||{})}return a(e,[{key:"_initialize",value:function(t){this._map=t.map,this._list=[],this._textColor=t.textColor||"#fff",this._font=t.font||"20px Arial",this._start=!1,this._createLayer()}},{key:"_createLayer",value:function(){var t=this._canvas=document.createElement("canvas");this._ctx=t.getContext("2d");var e=this._map.getSize();t.width=this._width=e.width,t.height=this._height=e.height,this._cus=new AMap.CustomLayer(t,{map:this._map,zIndex:100}),this._cus.render=this.reload.bind(this)}},{key:"reload",value:function(){this._list=this._list.map(function(t){return r({},t,{_pixel:null})})}},{key:"_draw",value:function(){null!=this.getMap()?(this._clearCanvas(),this._drawCanvas(),0<this._list.length?window.requestAnimationFrame(this._draw):this._start=!1):this._start=!1}},{key:"_clearCanvas",value:function(){this._ctx.clearRect(0,0,this._width,this._height)}},{key:"_drawCanvas",value:function(){if(null!=this.getMap()){var t=this._ctx,e=Date.now();t.textAlign="center",t.textBaseline="middle",t.fillStyle=this._textColor,t.font=this._font;for(var i=0;i<this._list.length;i++){var n=this._list[i],o=(e-n._time)/1e3;if(3<o)n._del=!0;else{var a=n._pixel||this._map.lngLatToContainer(n.position);n._pixel=a,t.save(),t.translate(a.getX(),a.getY());var s=1,r=1;o<1?(s/=o,r=o):2<o&&(s=r=3-o),1!=s&&t.scale(s,s),1!=r&&(t.globalAlpha=r),n.textColor&&(t.fillStyle=n.textColor),n.font&&(t.font=n.font),t.fillText(n.text,0,0),t.restore()}}this._list=this._list.filter(function(t){return!t._del})}}},{key:"push",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];i.forEach(function(t){e._list.push(r({},t,{_time:Date.now()}))}),this._start||(this._start=!0,this._draw())}},{key:"setMap",value:function(t){this._map=t,this._cus.setMap(t),null==t?this._start=!1:this._start||(this._start=!0,this._draw())}},{key:"getMap",value:function(){return this._map||null}},{key:"destroy",value:function(){this.setMap(null),this._cus=null}}]),e}(),P=function(){function e(t){o(this,e),this.__initialize(t||{})}return a(e,[{key:"__initialize",value:function(t){this.CLASS_NAME=this.constructor.name,this.__object3DLayer=t.object3DLayer,this.__map=t.map,this.__extData=t.extData}},{key:"__callMethod",value:function(e,i,t){var n=this;null!=t&&(Array.isArray(t)?t.forEach(function(t){n.__callMethod(e,i,t)}):null!=t?e[i](t):console.warn("传入值不是实例对象",t))}},{key:"getExtData",value:function(){return this.__extData}},{key:"setExtData",value:function(t){this.__extData=t}},{key:"getMap",value:function(){return this.__map}},{key:"setMap",value:function(t){this.__map=t}},{key:"getObject3DLayer",value:function(){return this.__object3DLayer||null}},{key:"setObject3DLayer",value:function(t){this.__object3DLayer=t}},{key:"getOverlays",value:function(){return this.__overlays}},{key:"setOverlays",value:function(t){this.__overlays=t}},{key:"show",value:function(){var t=this.__object3DLayer;if(t){var e=this.getOverlays();this.__callMethod(t,"add",e)}}},{key:"hide",value:function(){var t=this.__object3DLayer;if(t){var e=this.getOverlays();this.__callMethod(t,"remove",e)}}},{key:"destroy",value:function(){this.hide(),this.__object3DLayer=null}}]),e}(),j=function(t){function i(t){var e;return o(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e._clickHandle=e._clickHandle.bind(h(h(e))),e}return e(i,P),a(i,[{key:"_initialize",value:function(t){this._height=t.height||5e3,this._color=t.color||"#0088ffcc",this._transparent=f(t.transparent,!0);var e=p(t.coordinate);this._coordinate=this.lngLatToGeodeticCoord(e),this._click=t.click,this._position=t.position,this._textOption=t.textOption||{text:t.text||"未输入文字内容",textColor:t.textColor||"red"};var i=f(t.textClass,x);i&&this._createText(i)}},{key:"_clickHandle",value:function(){}},{key:"_createText",value:function(t){this._textObj&&("function"==typeof this._textObj.destroy&&this._textObj.destroy(),this._textObj=null);var e=r({map:this.getMap(),position:this._position},this._textOption);this._textObj=new t(e)}},{key:"getOverlays",value:function(){var t=this._prism;return t||((t=new AMap.Object3D.Prism({path:this._coordinate,height:this._height,color:this._color})).transparent=this._transparent,this._prism=t),t}},{key:"show",value:function(){u(l(i.prototype),"show",this).call(this),this._textObj&&this._textObj.setMap(this.getMap())}},{key:"hide",value:function(){u(l(i.prototype),"hide",this).call(this),this._textObj&&this._textObj.setMap(null)}},{key:"getText",value:function(){return this._textObj||null}},{key:"lngLatToGeodeticCoord",value:function(t){for(var e=this.getMap(),i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.length;o++){var a=e.lngLatToGeodeticCoord(n[o]);n[o]=a}return t}}]),i}(),z=function(t){function i(t){var e;return o(this,i),t.object3DLayer||(t.object3DLayer=new AMap.Object3DLayer,t.object3DLayer.setMap(t.map)),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._initialize(t),e}return e(i,P),a(i,[{key:"_initialize",value:function(t){this._height=t.height||5e3,this._color=t.color||"#0088ffcc",this._transparent=f(t.transparent,!0),this._textOption=t.textOption,this._textClass=t.textClass,this._click=t.click,this._polyrects=[]}},{key:"_clickHandle",value:function(t,e){"function"==typeof this._click&&this._click(t,e)}},{key:"setData",value:function(t){var i=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.clear();var n=f;this._polyrects=t.map(function(t){var e={map:i.getMap(),object3DLayer:i.getObject3DLayer(),coordinate:t.coordinate,color:n(t.color,i._color),height:n(t.height,i._height),transparent:n(t.transparent,i._transparent),extData:t.extData||t,position:t.position,textClass:n(t.textClass,i._textClass),textOption:v(i._textOption,t.textOption)};return new j(e)}),e&&this.show()}},{key:"getOverlays",value:function(){return this._polyrects.map(function(t){return t.getOverlays()})}},{key:"clear",value:function(){var t=this.getOverlays();t&&t.length&&t.forEach(function(t){t.destroy()}),this._polyrects=[]}},{key:"destroy",value:function(){u(l(i.prototype),"destroy",this).call(this)}}]),i}();return{Polyrect:b,NormalText:x,Text3D:w,PolyrectList:O,RadarChart:C,TextQueue:M,Utils:t,gl_Polyrect:j,gl_PolyrectList:z}});
