!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).AMapUtils=e()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}function r(n){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},e=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),e.forEach(function(t){var e,i,o;e=n,o=s[i=t],i in e?Object.defineProperty(e,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[i]=o})}return n}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function u(t,e,i){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function M(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _=function(){function e(t){n(this,e),this.__initialize(t||{})}return s(e,[{key:"__initialize",value:function(t){var e=this;this.CLASS_NAME=this.constructor.name,this.__map=t.map||null,this.__position=t.position,this.__zIndex=t.zIndex||10,this.__extData=t.extData,t.map&&setTimeout(function(){e.setMap(t.map)},1)}},{key:"__callMethod",value:function(t,e){for(var i=this,o=arguments.length,n=new Array(2<o?o-2:0),s=2;s<o;s++)n[s-2]=arguments[s];null!==t&&(Array.isArray(t)?t.forEach(function(t){i.__callMethod.apply(i,[t,e].concat(n))}):"object"===a(t)?"function"==typeof t[e]?t[e].apply(t,n):console.warn("对象找不到方法:"+e,t):console.warn("传入值不是实例对象",t))}},{key:"__changeOptions",value:function(o){var n=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=!1;return(Array.isArray(t)?t:Object.keys(o)).forEach(function(t){if(t in o){var e="_"+t,i=n[e];void 0===i&&console.warn("未找到该字段属性:"+t),i!==o[t]&&(n[e]=o[t],s=!0)}}),s}},{key:"getzIndex",value:function(){return this.__zIndex}},{key:"setzIndex",value:function(t){this.__zIndex=t;var e=this.getOverlays();this.__callMethod(e,"setzIndex",t)}},{key:"getExtData",value:function(){var t=this.__extData;return"function"!=typeof t?t:t()}},{key:"setExtData",value:function(t){this.__extData=t}},{key:"getPosition",value:function(){return this.__position}},{key:"setPosition",value:function(t){this.__position;var e=this.getOverlays();this.__callMethod(e,"setPosition",t)}},{key:"getOverlays",value:function(){return this.__overlays||null}},{key:"setOverlays",value:function(t){this.__overlays=t}},{key:"isShow",value:function(){return null!==this.getMap()}},{key:"setMap",value:function(t){this.__map=t;var e=this.getOverlays();this.__callMethod(e,"setMap",t)}},{key:"getMap",value:function(){return this.__map||null}},{key:"destroy",value:function(){this.setMap(null)}}]),e}();function p(t,e){return void 0===t?e:t}function f(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"|",a=[],r=/\d+(\.\d+)?/g;"string"==typeof t?t.split(e).forEach(function(t){if(t){var e=[],i=t.match(r);if(i){for(var o=1;o<i.length;o+=2){var n=parseFloat(i[o-1]),s=parseFloat(i[o]);e.push([n,s])}a.push(e)}}}):console.warn("经纬度格式有误:",t);return a}function d(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:20;return t?t.replace(/[^\\x00-\\xff]/g,"aa").length*e/2:0}function y(t,e,i,o){return{minZoom:t<i?i:t,maxZoom:o<e?o:e}}function v(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(t,e){return e?r({},t,e):t},{})}function g(t,e,i,o){var n=Math.abs(t-i),s=Math.abs(e-o),a=Math.sqrt(Math.pow(n,2)+Math.pow(s,2));if(0==a)return 0;var r=s/a,l=180*Math.acos(r)/Math.PI;return l=t<=i?e<=o?90-l:270+l:e<=o?90+l:270-l}function m(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}var t=Object.freeze({getDefaultByundefined:p,transposePolyrect:f,getTextWidth:d,getDiffObject:function(t,e){var i={},o=!1;for(var n in e){var s=t[n];void 0===s&&console.warn("目标对象未找到该参数:"+n);var a=e[n];s!==a&&(i[n]=a,o=!0)}return o?i:null},getIntersection:y,getMergeObject:v,getAngle:g,uuid:m,getFixMapBound:function(t,e,i,o,n){var s=t.getSouthWest(),a=t.getNorthEast(),r=a.getLng()-s.getLng(),l=a.getLat()-s.getLat(),h=l*i/n,c=r*e/o,u=r/o-r-c,_=l/n-l-h,p=[s.getLng()-c,s.getLat()-_],f=[a.getLng()+u,a.getLat()+h];return new AMap.Bounds(p,f)}});function k(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}k(".dcmap-normaltext-container {\n  width: 0px;\n  pointer-events: none; }\n  .dcmap-normaltext-container .text {\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center; }\n");var x=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e}return e(i,_),s(i,[{key:"_initialize",value:function(t){this._text=t.text||"",this._textColor=t.textColor||"#fff",this._paddingWidth=t.paddingWidth||20,this._textSize=t.textSize||20,this._paddingHeight=t.paddingHeight||10,this._offsetTop=t.offsetTop||0,this._offsetLeft=t.offsetLeft||0,this._createMarker()}},{key:"_createMarker",value:function(){var t=d(this._text,this._textSize)+this._paddingWidth,e=this._textSize+this._paddingHeight,i=this._dom=this._createElement(e,t),o=new AMap.Marker({position:this.getPosition(),offset:new AMap.Pixel(-t/2+this._offsetLeft,-e/2+this._offsetTop),content:i.body,bubble:!0,zIndex:this.getzIndex()});this.setOverlays(o)}},{key:"_createElement",value:function(t,e){var i=document.createElement("div");i.className="dcmap-normaltext-container",i.style.height=t+"px";var o=document.createElement("div");return o.className="text",o.style.width=e+"px",o.style.fontSize=this._textSize+"px",o.style.color=this._textColor,o.innerText=this._text,i.appendChild(o),{body:i,text:o}}},{key:"getTextColor",value:function(){return this._textColor}},{key:"setTextColor",value:function(t){this._textColor=t,this._dom.text.style.color=this._textColor}},{key:"getValue",value:function(){return this._text}},{key:"setValue",value:function(t){this._text=t,this._dom.text.innerText=this._text}}]),i}(),C=function(t){function o(t){var e;return n(this,o),(e=c(this,l(o).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(o,_),s(o,[{key:"_initialize",value:function(t){this._strokeColor=t.strokeColor||"#f00",this._strokeOpacity=p(t.strokeOpacity,.8),this._strokeWeight=p(t.strokeWeight,1),this._fillColor=t.fillColor||"blue",this._fillOpacity=p(t.fillOpacity,.2),this._textOption=t.textOption||{text:t.text||"未输入文字内容",textColor:t.textColor||"red"},this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._useCanvas=p(t.useCanvas,!1),this._coordinate=f(t.coordinate),this._checkCoordinate=f(t.checkCoordinate||""),this._createCheckPolygon(),this.isUseCanvas()?this._createCustomLayer():(this._createPolygon(),this._overLayGroup=new AMap.OverlayGroup(this._polygons));var e=p(t.textClass,x);e&&this._createText(e)}},{key:"_createText",value:function(t){var e=this;if(this._textObj&&("function"==typeof this._textObj.destroy&&this._textObj.destroy(),this._textObj=null),t){var i=p(this._textOption.minZoom,1),o=p(this._textOption.maxZoom,19),n=y(this.__minZoom,this.__maxZoom,i,o),s=r({map:this.getMap(),position:this.getPosition(),zIndex:this.getzIndex()},this._textOption,n,{extData:function(){var t=e.getExtData();return t||null}});this._textObj=new t(s)}else console.warn("未找到文字对象,检查textClass参数",t)}},{key:"_createCheckPolygon",value:function(){var i=this;this.hasCheckPolygon()&&(1<this._checkCoordinate.length&&console.warn("checkCoordinate建议设置为单区域简单多边形以提高性能"),this._checkPolygons=this._checkCoordinate.map(function(t){var e=new AMap.Polygon({path:t,strokeOpacity:0,strokeWeight:0,fillOpacity:0,zIndex:i.__zIndex+1,bubble:!0});return i._addEvent(e),e}))}},{key:"_createPolygon",value:function(){var i=this,o=this.hasCheckPolygon();this._polygons=this._coordinate.map(function(t){var e=new AMap.Polygon({path:t,strokeColor:i._strokeColor,strokeOpacity:i._strokeOpacity,strokeWeight:i._strokeWeight,fillColor:i._fillColor,fillOpacity:i._fillOpacity,zIndex:i.__zIndex,bubble:!0});return o||i._addEvent(e),e})}},{key:"_createCustomLayer",value:function(){var t=this._canvas=document.createElement("canvas");if(this._ctx=t.getContext("2d"),this.getMap()){var e=this.getMap().getSize();t.width=this._canvas_width=e.width,t.height=this._canvas_height=e.height}this._cus=new AMap.CustomLayer(t,{zIndex:10}),this._cus.render=this._draw.bind(this)}},{key:"_draw",value:function(){this._clearCanvas(this._ctx),this._drawCanvas(this._ctx)}},{key:"_clearCanvas",value:function(t){t.clearRect(0,0,this._canvas_width,this._canvas_height)}},{key:"_drawCanvas",value:function(i){var o=this;i.save(),i.strokeStyle=this._strokeColor,i.lineWidth=this._strokeWeight,i.fillStyle=this._fillColor,this._coordinate.forEach(function(t){var e=t.map(function(t){return o.getMap().lngLatToContainer(t)});i.beginPath(),i.globalAlpha=o._strokeOpacity,e.forEach(function(t){i.lineTo(t.getX(),t.getY())}),i.closePath(),i.stroke(),i.globalAlpha=o._fillOpacity,i.fill()}),i.restore()}},{key:"_addEvent",value:function(t){t.on("mouseover",this._mouseOver),t.on("mouseout",this._mouseOut),t.on("click",this._clickHandle)}},{key:"_mouseOut",value:function(t){"function"==typeof this._mouseout&&this._mouseout.call(this,this.getExtData(),t,this)}},{key:"_mouseOver",value:function(t){"function"==typeof this._mouseover&&this._mouseover.call(this,this.getExtData(),t,this)}},{key:"_clickHandle",value:function(t){"function"==typeof this._click&&this._click.call(this,this.getExtData(),t,this)}},{key:"isUseCanvas",value:function(){return!!this._useCanvas}},{key:"getText",value:function(){return this._textObj||null}},{key:"setText",value:function(t){var e=this.getText();e&&e.destroy(),this._textObj=t,this.getMap()}},{key:"getPolygonStyle",value:function(){return{strokeColor:this._strokeColor,strokeOpacity:this._strokeOpacity,strokeWeight:this._strokeWeight,fillColor:this._fillColor,fillOpacity:this._fillOpacity}}},{key:"setPolygonStyle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.__changeOptions(t,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"])&&(this.isUseCanvas()?this._draw():this._overLayGroup.setOptions(t))}},{key:"getOverlays",value:function(){var t=M(this._checkPolygons||[]);this._polygons&&t.push.apply(t,M(this._polygons));var e=this.getText();return e&&t.push(e),this._cus&&t.push(this._cus),t}},{key:"setMap",value:function(t){if(u(l(o.prototype),"setMap",this).call(this,t),t&&this.isUseCanvas()){var e=this._canvas,i=t.getSize();e.width=this._canvas_width=i.width,e.height=this._canvas_height=i.height}}},{key:"hasCheckPolygon",value:function(){return this._checkCoordinate&&0<this._checkCoordinate.length}},{key:"destroy",value:function(){u(l(o.prototype),"destroy",this).call(this)}}]),o}(),b=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(i,_),s(i,[{key:"_clickHandle",value:function(t,e,i){"function"==typeof this._click&&this._click.call(this,i,e)}},{key:"_mouseOut",value:function(t,e,i){"function"==typeof this._mouseout&&this._mouseout.call(this,i,e)}},{key:"_mouseOver",value:function(t,e,i){"function"==typeof this._mouseover&&this._mouseover.call(this,i,e)}},{key:"_initialize",value:function(t){this._strokeColor=t.strokeColor||"#f00",this._strokeOpacity=p(t.strokeOpacity,.8),this._strokeWeight=p(t.strokeWeight,1),this._fillColor=t.fillColor||"blue",this._fillOpacity=p(t.fillOpacity,.2),this._textOption=t.textOption,this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._useCanvas=p(t.useCanvas,!1),this._textClass=t.textClass,this._polyrects=[]}},{key:"getPolygonStyle",value:function(){return{strokeColor:this._strokeColor,strokeOpacity:this._strokeOpacity,strokeWeight:this._strokeWeight,fillColor:this._fillColor,fillOpacity:this._fillOpacity}}},{key:"setPolygonStyle",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.__changeOptions(e,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"])&&this._polyrects&&0<this._polyrects.length&&this._polyrects.forEach(function(t){t.setPolygonStyle(e)})}},{key:"setData",value:function(t){var i=this;this.clear();var o=p;this._polyrects=t.map(function(t){var e={map:i.getMap(),checkCoordinate:t.checkCoordinate,coordinate:t.coordinate,position:t.position,strokeColor:o(t.strokeColor,i._strokeColor),strokeWeight:o(t.strokeWeight,i._strokeWeight),strokeOpacity:o(t.strokeOpacity,i._strokeOpacity),fillColor:o(t.fillColor,i._fillColor),fillOpacity:o(t.fillOpacity,i._fillOpacity),textOption:v(i._textOption,t.textOption),textClass:o(t.textClass,i._textClass),useCanvas:i._useCanvas,click:i._clickHandle,mouseout:i._mouseOut,mouseover:i._mouseOver,extData:t.extData||t,zIndex:t.zIndex||i.getzIndex()};return new C(e)})}},{key:"getPolyrects",value:function(){return M(this._polyrects||[])}},{key:"showText",value:function(){var i=this;this.getPolyrects().forEach(function(t){var e=t.getText();e&&e.setMap(i.getMap())})}},{key:"hideText",value:function(){this.getPolyrects().forEach(function(t){var e=t.getText();e&&e.setMap(null)})}},{key:"clear",value:function(){var t=this.getOverlays();t&&0<t.length&&(t.forEach(function(t){t.destroy()}),this._polyrects=[])}},{key:"getOverlays",value:function(){return this.getPolyrects()}},{key:"destroy",value:function(){u(l(i.prototype),"destroy",this).call(this)}}]),i}();k('.dcmap-text3d-container {\n  width: 0;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: space-between;\n  align-items: center;\n  -webkit-transform-style: preserve-3d;\n          transform-style: preserve-3d; }\n  .dcmap-text3d-container .map-point-text-dom {\n    width: 500px;\n    display: flex;\n    justify-content: center;\n    font-size: 16px;\n    pointer-events: none; }\n  .dcmap-text3d-container .map-point-img-dom {\n    width: 25px;\n    height: 35px;\n    margin: 3px 0;\n    background-image: url("http://qn.fengyitong.name/point.png"); }\n  .dcmap-text3d-container .map-point-small-circle {\n    position: absolute;\n    width: 54px;\n    height: 54px;\n    bottom: -20px;\n    left: 50%;\n    margin-left: -27px;\n    background-color: #0080fe;\n    opacity: 0.5;\n    border-radius: 50%;\n    -webkit-animation: amap-utils-delayLiving 1.5s linear infinite;\n            animation: amap-utils-delayLiving 1.5s linear infinite;\n    display: none; }\n  .dcmap-text3d-container .map-point-large-circle {\n    position: absolute;\n    width: 116px;\n    height: 116px;\n    bottom: -50px;\n    left: 50%;\n    margin-left: -58px;\n    background-color: #0080fe;\n    border-radius: 50%;\n    opacity: 0;\n    -webkit-animation: amap-utils-bigliving 1.5s linear infinite;\n            animation: amap-utils-bigliving 1.5s linear infinite;\n    display: none; }\n\n@-webkit-keyframes amap-utils-delayLiving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.1; }\n  30% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.5; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@keyframes amap-utils-delayLiving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.1; }\n  30% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.5; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@-webkit-keyframes amap-utils-bigliving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.3; }\n  /* 50% {\r\n      transform: scale(2);\r\n      opacity: 0;\r\n    } */\n  70% {\n    -webkit-transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n            transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n    opacity: 0.1; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n\n@keyframes amap-utils-bigliving {\n  0% {\n    -webkit-transform: rotateX(60deg) scale3d(0, 0, 1);\n            transform: rotateX(60deg) scale3d(0, 0, 1);\n    opacity: 0.3; }\n  /* 50% {\r\n      transform: scale(2);\r\n      opacity: 0;\r\n    } */\n  70% {\n    -webkit-transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n            transform: rotateX(60deg) scale3d(0.8, 0.8, 1);\n    opacity: 0.1; }\n  100% {\n    -webkit-transform: rotateX(60deg) scale3d(1, 1, 1);\n            transform: rotateX(60deg) scale3d(1, 1, 1);\n    opacity: 0; } }\n');var O=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._mouseOut=e._mouseOut.bind(h(h(e))),e._mouseOver=e._mouseOver.bind(h(h(e))),e._initialize(t||{}),e}return e(i,_),s(i,[{key:"_initialize",value:function(t){this._text=t.text||"",this._textColor=t.textColor,this._showRipples=!!t.isShowRipples,this._imageOption=t.imageOption||{},this._className=t.className,this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this._createMarker()}},{key:"showRipples",value:function(){var t=this._dom;t.smallCircle.style.display="block",t.largeCircle.style.display="block",this._showRipples=!0}},{key:"closeRipples",value:function(){var t=this._dom;t.smallCircle.style.display="",t.largeCircle.style.display="",this._showRipples=!1}},{key:"_clickHandle",value:function(t){"function"==typeof this._click&&this._click.call(this,this.getExtData(),t)}},{key:"_mouseOut",value:function(t){"function"==typeof this._mouseout&&this._mouseout.call(this,this.getExtData(),t)}},{key:"_mouseOver",value:function(t){"function"==typeof this._mouseover&&this._mouseover.call(this,this.getExtData(),t)}},{key:"_createMarker",value:function(){var t=this._dom=this._createElement(),e=this._imageOption.height||35;t.body.addEventListener("mouseenter",this._mouseOver),t.body.addEventListener("mouseleave",this._mouseOut),t.body.addEventListener("click",this._clickHandle);var i=new AMap.Marker({position:this.__position,offset:new AMap.Pixel(0,-e-20),content:t.body,zIndex:this.getzIndex()});this.setOverlays(i),this._showRipples&&this.showRipples()}},{key:"getValue",value:function(){return this._text}},{key:"setValue",value:function(t){this._dom.text.innerText=strText,this._text=strText}},{key:"_createElement",value:function(){var t=this._imageOption.height||35,e=document.createElement("div");e.className="dcmap-text3d-container "+this._className,e.style.height=t+30+"px";var i=document.createElement("div");i.className="map-point-small-circle",e.appendChild(i);var o=document.createElement("div");o.className="map-point-large-circle",e.appendChild(o);var n=document.createElement("span");n.className="map-point-text-dom",n.style.color=this._textColor,n.innerText=this._text,e.appendChild(n);var s=document.createElement("div");return s.className="map-point-img-dom",s.style.width=this._imageOption.width||25,s.style.height=t,this._imageOption.src&&(s.style.backgroundImage="url('".concat(this._imageOption.src,"')")),e.appendChild(s),{body:e,text:n,img:s,smallCircle:i,largeCircle:o}}}]),i}(),w=function(){function e(t){n(this,e),this._draw=this._draw.bind(this),this._initialize(t||{})}return s(e,[{key:"_initialize",value:function(t){this._map=t.map,this._center=t.center,this._target=t.target,this._speed=t.speed||60,this._coverNumber=t.coverNumber||.2,this._fillStyle=t.fillStyle||"rgba(0,200,0,0.7)",this._callback=t.callback,this._isStart=!1,this._deg=360-~~g.apply(void 0,M(this._center).concat(M(this._target))),this._createCanvasLayer()}},{key:"_createCanvasLayer",value:function(){var t=this._canvas=document.createElement("canvas");this._ctx=t.getContext("2d");var e,i,o,n=(e=this._center,i=this._target,o=Math.sqrt(Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2)),{minPosition:[e[0]-o,e[1]-o],maxPosition:[e[0]+o,e[1]+o]}),s=this._map.lngLatToContainer(n.minPosition),a=this._map.lngLatToContainer(n.maxPosition);t.width=t.height=this._width=this._height=a.getX()-s.getX(),this._clayer=new AMap.CanvasLayer({canvas:t,bounds:new AMap.Bounds(n.minPosition,n.maxPosition),zIndex:100}),this._clayer.setMap(this._map)}},{key:"start",value:function(){this._isStart||(this._isStart=!0,this._draw())}},{key:"stop",value:function(){var t=this;this._isStart&&(this._isStart=!1,setTimeout(function(){t._ctx.clearRect(0,0,t._width,t._height)},1))}},{key:"destroy",value:function(){this.stop(),this._clayer.setMap(null),this._clayer=null}},{key:"_drawCircle",value:function(){var t=(this._width>this._height?this._height:this._width)/2,e=this._ctx2;e.clearRect(0,0,this._width,this._height),e.fillStyle=this._fillStyle,e.globalAlpha=.2,e.beginPath(),e.moveTo(this._width/2,this._height/2),e.arc(this._width/2,this._height/2,t,0,2*Math.PI),e.closePath(),e.fill()}},{key:"_draw",value:function(){var t=this._deg;this._deg+=360/this._speed,360<=this._deg&&(this._deg=this._deg-360),this._isStart&&(this._drawRadar(),this._cover(),this._clayer.reFresh(),"function"==typeof this._callback&&this._callback.call(this,{start:t,end:this._deg>t?this._deg:this._deg+t}),window.requestAnimationFrame(this._draw))}},{key:"_drawRadar",value:function(){var t=this._deg,e=this._ctx,i=(this._width>this._height?this._height:this._width)/2;e.save(),e.fillStyle=this._fillStyle,e.beginPath(),e.moveTo(this._width/2,this._height/2),e.arc(this._width/2,this._height/2,i,(-360/this._speed+t)/180*Math.PI,t/180*Math.PI),e.closePath(),e.fill(),e.restore()}},{key:"_cover",value:function(){var t=this._ctx;t.save();this._width>this._height?this._height:this._width;t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0,0,0,".concat(this._coverNumber,")"),t.rect(0,0,this._width,this._height),t.fill(),t.restore()}},{key:"_clearRect",value:function(){this._ctx.clearRect(0,0,this.width,this.height)}}]),e}();var P=function(){function e(t){n(this,e),this._draw=this._draw.bind(this),this._initialize(t||{})}return s(e,[{key:"_initialize",value:function(t){this._map=t.map,this._list=[],this._textColor=t.textColor||"#fff",this._font=t.font||"20px Arial",this._start=!1,this._createLayer()}},{key:"_createLayer",value:function(){var t=this._canvas=document.createElement("canvas");this._ctx=t.getContext("2d");var e=this._map.getSize();t.width=this._width=e.width,t.height=this._height=e.height,this._cus=new AMap.CustomLayer(t,{map:this._map,zIndex:100}),this._cus.render=this.reload.bind(this)}},{key:"reload",value:function(){this._list=this._list.map(function(t){return r({},t,{_pixel:null})})}},{key:"_draw",value:function(){null!=this.getMap()?(this._clearCanvas(),this._drawCanvas(),0<this._list.length?window.requestAnimationFrame(this._draw):this._start=!1):this._start=!1}},{key:"_clearCanvas",value:function(){this._ctx.clearRect(0,0,this._width,this._height)}},{key:"_drawCanvas",value:function(){if(null!=this.getMap()){var t=this._ctx,e=Date.now();t.textAlign="center",t.textBaseline="middle",t.fillStyle=this._textColor,t.font=this._font;for(var i=0;i<this._list.length;i++){var o=this._list[i],n=(e-o._time)/1e3;if(3<n)o._del=!0;else{var s=o._pixel||this._map.lngLatToContainer(o.position);o._pixel=s,t.save(),t.translate(s.getX(),s.getY());var a=1,r=1;n<1?(a/=n,r=n):2<n&&(a=r=3-n),1!=a&&t.scale(a,a),1!=r&&(t.globalAlpha=r),o.textColor&&(t.fillStyle=o.textColor),o.font&&(t.font=o.font),t.fillText(o.text,0,0),t.restore()}}this._list=this._list.filter(function(t){return!t._del})}}},{key:"push",value:function(){for(var e=this,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];i.forEach(function(t){e._list.push(r({},t,{_time:Date.now()}))}),this._start||(this._start=!0,this._draw())}},{key:"setMap",value:function(t){this._map=t,this._cus.setMap(t),null==t?this._start=!1:this._start||(this._start=!0,this._draw())}},{key:"getMap",value:function(){return this._map||null}},{key:"destroy",value:function(){this.setMap(null),this._cus=null}}]),e}();k(".dcmap-shadowtext-container {\n  -webkit-perspective: 2000px;\n          perspective: 2000px;\n  position: relative; }\n  .dcmap-shadowtext-container .dcmap-shadowtext-text {\n    display: flex;\n    justify-content: center; }\n  .dcmap-shadowtext-container .dcmap-shadowtext-shadow {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    -webkit-transform: rotateX(65deg);\n            transform: rotateX(65deg);\n    background: radial-gradient(ellipse, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0) 60%); }\n");var j=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e}return e(i,_),s(i,[{key:"_initialize",value:function(t){this._text=t.text||"未输入文字",this._textColor=t.textColor||"#fff",this._textSize=t.textSize||20,this._shaderRatio=t.shaderRatio||1.2,this._offsetTop=t.offsetTop||0,this._offsetLeft=t.offsetLeft||0,this._createMarker()}},{key:"_createMarker",value:function(){var t=d(this._text,this._textSize),e=this._textSize;this._dom=this._createElement(e,t);var i=new AMap.Marker({position:this.getPosition(),offset:new AMap.Pixel(-this._shaderRatio*t/2+this._offsetLeft,-e/3*2+this._offsetTop),content:this._dom.body,zIndex:this.getzIndex()});this.setOverlays(i)}},{key:"_createElement",value:function(t,e){var i=document.createElement("div");i.className="dcmap-shadowtext-container",i.style.width=e*this._shaderRatio+"px",i.style.height=2*t+"px";var o=document.createElement("div");o.className="dcmap-shadowtext-text",o.style.fontSize=this._textSize+"px",o.style.color=this._textColor,o.innerText=this._text,i.appendChild(o);var n=document.createElement("div");return n.className="dcmap-shadowtext-shadow",n.style.top=t/2+"px",i.appendChild(n),{body:i,text:o,shadow:n}}},{key:"getTextColor",value:function(){return this._textColor}},{key:"setTextColor",value:function(t){this._textColor=t,this._dom.text.style.color=this._textColor}},{key:"getValue",value:function(){return this._text}},{key:"setValue",value:function(t){this._text=t,this._dom.text.innerText=this._text}}]),i}();function D(t,e,i){return 0<=(e-t)*(t-i)?t:0<=(t-e)*(e-i)?e:i}var z=Object.freeze({getMedian:D}),E=function(){function e(t){n(this,e),this.__initialize(t||{})}return s(e,[{key:"__initialize",value:function(t){this.CLASS_NAME=this.constructor.name,this.__object3DLayer=t.object3DLayer,this.__map=t.map,this.__extData=t.extData}},{key:"__callMethod",value:function(e,i,t){var o=this;null!=t&&(Array.isArray(t)?t.forEach(function(t){o.__callMethod(e,i,t)}):void 0!==t?e[i](t):console.warn("传入值不是实例对象",t))}},{key:"getExtData",value:function(){return this.__extData}},{key:"setExtData",value:function(t){this.__extData=t}},{key:"getMap",value:function(){return this.__map}},{key:"setMap",value:function(t){this.__map=t}},{key:"getObject3DLayer",value:function(){return this.__object3DLayer||null}},{key:"setObject3DLayer",value:function(t){this.__object3DLayer=t}},{key:"getOverlays",value:function(){return this.__overlays}},{key:"setOverlays",value:function(t){this.__overlays=t}},{key:"show",value:function(){var t=this.__object3DLayer;if(t){var e=this.getOverlays();this.__callMethod(t,"add",e)}}},{key:"hide",value:function(){var t=this.__object3DLayer;if(t){var e=this.getOverlays();this.__callMethod(t,"remove",e)}}},{key:"destroy",value:function(){this.hide(),this.__object3DLayer=null}}]),e}(),L=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e._clickHandle=e._clickHandle.bind(h(h(e))),e}return e(i,E),s(i,[{key:"_initialize",value:function(t){this._height=t.height||5e3,this._color=t.color||"#0088ffcc",this._transparent=p(t.transparent,!0);var e=f(t.coordinate);this._coordinate=this.lngLatToGeodeticCoord(e),this._click=t.click,this._position=t.position,this._textOption=t.textOption||{text:t.text||"未输入文字内容",textColor:t.textColor||"red"};var i=p(t.textClass,x);i&&this._createText(i)}},{key:"_clickHandle",value:function(){}},{key:"_createText",value:function(t){this._textObj&&("function"==typeof this._textObj.destroy&&this._textObj.destroy(),this._textObj=null);var e=r({map:this.getMap(),position:this._position},this._textOption);this._textObj=new t(e)}},{key:"getOverlays",value:function(){var t=this._prism;return t||((t=new AMap.Object3D.Prism({path:this._coordinate,height:this._height,color:this._color})).transparent=this._transparent,this._prism=t),t}},{key:"show",value:function(){u(l(i.prototype),"show",this).call(this),this._textObj&&this._textObj.setMap(this.getMap())}},{key:"hide",value:function(){u(l(i.prototype),"hide",this).call(this),this._textObj&&this._textObj.setMap(null)}},{key:"getText",value:function(){return this._textObj||null}},{key:"lngLatToGeodeticCoord",value:function(t){for(var e=this.getMap(),i=0;i<t.length;i++)for(var o=t[i],n=0;n<o.length;n++){var s=e.lngLatToGeodeticCoord(o[n]);o[n]=s}return t}}]),i}(),T=function(t){function i(t){var e;return n(this,i),t.object3DLayer||(t.object3DLayer=new AMap.Object3DLayer,t.object3DLayer.setMap(t.map)),(e=c(this,l(i).call(this,t)))._clickHandle=e._clickHandle.bind(h(h(e))),e._initialize(t),e}return e(i,E),s(i,[{key:"_initialize",value:function(t){this._height=t.height||5e3,this._color=t.color||"#0088ffcc",this._transparent=p(t.transparent,!0),this._textOption=t.textOption,this._textClass=t.textClass,this._click=t.click,this._polyrects=[]}},{key:"_clickHandle",value:function(t,e){"function"==typeof this._click&&this._click(t,e)}},{key:"setData",value:function(t){var i=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.clear();var o=p;this._polyrects=t.map(function(t){var e={map:i.getMap(),object3DLayer:i.getObject3DLayer(),coordinate:t.coordinate,color:o(t.color,i._color),height:o(t.height,i._height),transparent:o(t.transparent,i._transparent),extData:t.extData||t,position:t.position,textClass:o(t.textClass,i._textClass),textOption:v(i._textOption,t.textOption)};return new L(e)}),e&&this.show()}},{key:"getOverlays",value:function(){return this._polyrects.map(function(t){return t.getOverlays()})}},{key:"clear",value:function(){var t=this.getOverlays();t&&t.length&&t.forEach(function(t){t.destroy()}),this._polyrects=[]}},{key:"destroy",value:function(){u(l(i.prototype),"destroy",this).call(this)}}]),i}(),S=function(t){function i(t){var e;return n(this,i),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e}return e(i,E),s(i,[{key:"_initialize",value:function(t){this._height=p(t.height,1e3),this._radius=p(t.radius,1e3),this._segment=p(t.segment,4),this._transparent=p(t.transparent,!0),this._color=t.color||[0,0,1,.4],this._topColor=t.topColor,this._bottomColor=t.bottomColor,this._topFaceColor=t.topFaceColor,this._position=t.position,this._createMesh()}},{key:"getTopColor",value:function(){return this._topColor||this._color}},{key:"getBottomColor",value:function(){return this._bottomColor||this._color}},{key:"getTopFaceColor",value:function(){return this._topFaceColor||this._color}},{key:"_createMesh",value:function(){for(var t=this._segment,e=this._radius,i=this.getMap().lngLatToGeodeticCoord(this._position),o=this._height,n=this.getTopColor(),s=this.getBottomColor(),a=this.getTopFaceColor(),r=new AMap.Object3D.Mesh,l=r.geometry,h=2*this._segment,c=[],u=0;u<t;u++){var _,p=2*Math.PI*u/t,f=i.x+Math.cos(p)*e,d=i.y+Math.sin(p)*e;c.push([f,d]),l.vertices.push(f,d,0),l.vertices.push(f,d,-o),(_=l.vertexColors).push.apply(_,M(s).concat(M(n)));var y=2*u,v=y+1,g=(y+2)%h,m=(y+3)%h;l.faces.push(y,v,m),l.faces.push(y,m,g)}for(var k=0;k<t;k++){var x,C;(x=l.vertices).push.apply(x,M(l.vertices.slice(6*k+3,6*k+6))),(C=l.vertexColors).push.apply(C,M(a))}for(var b=AMap.GeometryUtil.triangulateShape(c),O=2*t,w=0;w<b.length;w+=3)l.faces.push(b[w]+O,b[w+2]+O,b[w+1]+O);r.transparent=this._transparent,(r.__class=this).setOverlays(r)}},{key:"setColor",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];t.color&&(this._color=t.color),t.topColor&&(this._topColor=t.topColor),t.bottomColor&&(this._bottomColor=t.bottomColor),t.topFaceColor&&(this._topFaceColor=t.topFaceColor),this._updateColor(e)}},{key:"getColor",value:function(){return{topColor:this._topColor,bottomColor:this._bottomColor,topFaceColor:this._topFaceColor,color:this._color}}},{key:"_updateColor",value:function(){for(var t,e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],i=this.getOverlays(),o=[],n=this._segment,s=this.getBottomColor(),a=this.getTopColor(),r=this.getTopFaceColor(),l=0;l<n;l++)o.push.apply(o,M(s).concat(M(a)));for(var h=0;h<n;h++)o.push.apply(o,M(r));(t=i.geometry.vertexColors).splice.apply(t,[0,i.geometry.vertexColors.length].concat(o)),i.needUpdate=!0,e&&i.reDraw()}},{key:"getHeight",value:function(){return this._height}},{key:"setHeight",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e4,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._height=t;for(var i=this.getOverlays(),o=i.geometry.vertices,n=this._segment,s=0;s<n;s++){o[6*s+5]=-t}for(var a=6*n-1+3;a<o.length;a+=3)o[a]=-t;i.needUpdate=!0,e&&i.reDraw()}},{key:"getRadius",value:function(){return this._radius}},{key:"setRadius",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e4,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._radius=t,this._updateVertices(e)}},{key:"getPosition",value:function(){return this._position}},{key:"setPosition",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[120,30],e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._position=t,this._updateVertices(e)}},{key:"_updateVertices",value:function(){for(var t,e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],i=this._segment,o=this._radius,n=this.getMap().lngLatToGeodeticCoord(this._position),s=this._height,a=this.getOverlays(),r=[],l=0;l<i;l++){var h=2*Math.PI*l/i,c=n.x+Math.cos(h)*o,u=n.y+Math.sin(h)*o;r.push(c,u,0,c,u,-s)}for(var _=0;_<i;_++)r.push.apply(r,M(r.slice(6*_+3,6*_+6)));(t=a.geometry.vertices).splice.apply(t,[0,a.geometry.vertices.length].concat(r)),a.needUpdate=!0,e&&a.reDraw()}},{key:"reDraw",value:function(){this.getOverlays().reDraw()}}]),i}(),A=function(t){function i(t){var e;return n(this,i),t.object3DLayer||(t.object3DLayer=new AMap.Object3DLayer,t.object3DLayer.setMap(t.map)),(e=c(this,l(i).call(this,t)))._initialize(t||{}),e}return e(i,E),s(i,[{key:"_initialize",value:function(t){this._height=p(t.height,1e3),this._radius=p(t.radius,1e3),this._segment=p(t.segment,4),this._transparent=p(t.transparent,!0),this._color=t.color||[0,0,1,.4],this._topColor=t.topColor,this._bottomColor=t.bottomColor,this._topFaceColor=t.topFaceColor,this._click=t.click,this._mouseover=t.mouseover,this._mouseout=t.mouseout,this.__activePrism=null,this._animateCache={},this._initEvent()}},{key:"_initEvent",value:function(){"function"==typeof this._click&&this.getMap().on("click",this._clickHandle,this),"function"!=typeof this._mouseover&&"function"!=typeof this._mouseout||this.getMap().on("mousemove",this._mouseMove,this)}},{key:"_clickHandle",value:function(t){var e=this.getMap().getObject3DByContainerPos(t.pixel,[this.getObject3DLayer()],!1);if(null!=e&&e.object.__class){var i=e.object.__class;"function"==typeof this._click&&this._click(i,e)}}},{key:"_mouseMove",value:function(t){var e=this.getMap().getObject3DByContainerPos(t.pixel,[this.getObject3DLayer()],!1);if(null!=e&&e.object.__class){var i=e.object.__class;this.__activePrism!=i&&(this.__activePrism&&("function"==typeof this._mouseout&&this._mouseout(this.__activePrism),this.__activePrism=null),this.__activePrism=i,"function"==typeof this._mouseover&&this._mouseover(i))}else this.__activePrism&&("function"==typeof this._mouseout&&this._mouseout(this.__activePrism),this.__activePrism=null)}},{key:"getTopColor",value:function(){return this._topColor||this._color}},{key:"getBottomColor",value:function(){return this._bottomColor||this._color}},{key:"getTopFaceColor",value:function(){return this._topFaceColor||this._color}},{key:"setData",value:function(t){var n=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.clear(),this._meshs=t.map(function(t){var e=t.height||n._height,i={map:n.getMap(),object3DLayer:n.getObject3DLayer(),position:t.position,radius:t.radius||n._radius,height:e,segment:t.segment||n._segment,topColor:t.topColor||n.getTopColor(),bottomColor:t.bottomColor||n.getBottomColor(),topFaceColor:t.topFaceColor||n.getTopFaceColor(),transparent:p(t.transparent,n._transparent),extData:t.extData||t},o=new S(i);return o.__id=m(),o}),e&&this.show()}},{key:"updateHeight",value:function(t){var s=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:H,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2e4,l=M(this._meshs);t.forEach(function(t){for(var e=0;e<l.length;e++){var i=l[e],o=i.getExtData();if(a(t,o)){if(r){var n=i.__id;s._animateCache[n]?s._animateCache[n].sourceHeight=t.height:(s._animateCache[n]={mesh:i,sourceHeight:t.height,step:r,index:null},s._animateHeight(n))}else i.setHeight(t.height);l.slice(e,1);break}}})}},{key:"updateColor",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:H;if(Array.isArray(e)){var s=M(this._meshs);e.forEach(function(t){for(var e=0;e<s.length;e++){var i=s[e],o=i.getExtData();if(n(t,o)){i.setColor(t),s.slice(e,1);break}}})}else this._meshs.forEach(function(t){t.setColor(e)})}},{key:"updateRadius",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:H;if(Array.isArray(e)){var s=M(this._meshs);e.forEach(function(t){for(var e=0;e<s.length;e++){var i=s[e],o=i.getExtData();if(n(t,o)){i.setRadius(t.radius),s.slice(e,1);break}}})}else this._meshs.forEach(function(t){t.setRadius(e.radius)})}},{key:"_animateHeight",value:function(t){var e=this,i=this._animateCache[t],o=i.mesh,n=i.sourceHeight,s=o.getHeight(),a=i.step,r=D(s,s<n?s+a:s-a,n);o.setHeight(r),r!==n?this._animateCache[t].index=requestAnimationFrame(function(){e._animateHeight(t)}):delete this._animateCache[t]}},{key:"getOverlays",value:function(){return this._meshs&&this._meshs.length?this._meshs.map(function(t){return t.getOverlays()}):null}},{key:"clear",value:function(){this._meshs&&this._meshs.length&&(this._meshs.forEach(function(t){t.destroy()}),this._meshs=[])}},{key:"destroy",value:function(){for(var t in this.__map.off("mousemove",this._mouseMove,this),this.__map.off("click",this._clickHandle,this),this._animateCache){var e=this._animateCache[key];e.index&&cancelAnimationFrame(e.index)}u(l(i.prototype),"destroy",this).call(this)}}]),i}();function H(t,e){return t.id===e.id}return{Overlays:_,Polyrect:C,NormalText:x,Text3D:O,PolyrectList:b,RadarChart:w,TextQueue:P,ShadowText:j,Utils:t,Math:z,gl_Polyrect:L,gl_PolyrectList:T,gl_RegularPrism:S,gl_RegularPrismList:A}});
